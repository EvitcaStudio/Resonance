var n=[,(e,t,n)=>{function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,d(i.key),i)}}function d(e){e=function(e,t){if("object"!==i(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!==i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}
/**
* Class for creating a tweening animation
* @class Tween  
* @license Tween does not have a license at this time. For licensing contact the author
* @author https://github.com/doubleactii
* Copyright (c) 2023 Evitca Studio
*/(e,"string");return"symbol"===i(e)?e:String(e)}n.r(t),n.d(t,{Tween:()=>s});var s=function(){function r(){var e,u=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=t.start,n=void 0===n?{}:n,i=t.end,i=void 0===i?{}:i,a=t.duration,a=void 0===a?1e3:a,t=t.easing,t=void 0===t?r.linear:t,s=this,o=r;if(!(s instanceof o))throw new TypeError("Cannot call a class as a function");s=this,o=function(){if(u.tweening&&!u.paused){var e,t=Date.now(),n=(u.lastTime||(u.lastTime=t),u.elapsed+=t-u.lastTime,u.elapsed/u.duration);for(e in 1<(n=u.oscillating?(1-Math.cos(n*Math.PI))/2:n)&&(n=1),u.end){var i,a=u.start[e],s=u.end[e];"string"==typeof a&&(3===a.length||6===a.length)||4===a.length||7===a.length?(a=r._hexToRgb(a),s=r._hexToRgb(s),i=[u.easing(n,a[0],s[0]-a[0],1),u.easing(n,a[1],s[1]-a[1],1),u.easing(n,a[2],s[2]-a[2],1)],u.exportedValues[e]=r._rgbToHex(i)):u.exportedValues[e]=u.easing(n,a,s-a,1)}u.update(u.exportedValues),1!==n||u.oscillating?requestAnimationFrame(u.animationFrame):(u.stop(),u.events.end&&u.events.end()),u.lastTime=t}},(e=d(e="animationFrame"))in s?Object.defineProperty(s,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):s[e]=o,this._build(n,i,a,t)}var e,t,n;return e=r,n=[{key:"linear",value:function(e,t,n,i){return n*e/i+t}},{key:"easeInQuad",value:function(e,t,n,i){return n*(e/=i)*e+t}},{key:"easeOutQuad",value:function(e,t,n,i){return-n*(e/=i)*(e-2)+t}},{key:"easeInOutQuad",value:function(e,t,n,i){return(e/=i/2)<1?n/2*e*e+t:-n/2*(--e*(e-2)-1)+t}},{key:"easeInSine",value:function(e,t,n,i){return-n*Math.cos(e/i*(Math.PI/2))+n+t}},{key:"easeOutSine",value:function(e,t,n,i){return n*Math.sin(e/i*(Math.PI/2))+t}},{key:"easeInOutSine",value:function(e,t,n,i){return-n/2*(Math.cos(Math.PI*e/i)-1)+t}},{key:"easeInExpo",value:function(e,t,n,i){return 0==e?t:n*Math.pow(2,10*(e/i-1))+t}},{key:"easeOutExpo",value:function(e,t,n,i){return e==i?t+n:n*(1-Math.pow(2,-10*e/i))+t}},{key:"easeInOutExpo",value:function(e,t,n,i){return 0==e?t:e==i?t+n:(e/=i/2)<1?n/2*Math.pow(2,10*(e-1))+t:n/2*(2-Math.pow(2,-10*--e))+t}},{key:"easeInCirc",value:function(e,t,n,i){return-n*(Math.sqrt(1-(e/=i)*e)-1)+t}},{key:"easeOutCirc",value:function(e,t,n,i){return n*Math.sqrt(1-(e=e/i-1)*e)+t}},{key:"easeInOutCirc",value:function(e,t,n,i){return(e/=i/2)<1?-n/2*(Math.sqrt(1-e*e)-1)+t:n/2*(Math.sqrt(1-(e-=2)*e)+1)+t}},{key:"easeInCubic",value:function(e,t,n,i){return n*(e/=i)*e*e+t}},{key:"easeOutCubic",value:function(e,t,n,i){return n*((e=e/i-1)*e*e+1)+t}},{key:"easeInOutCubic",value:function(e,t,n,i){return(e/=i/2)<1?n/2*e*e*e+t:n/2*((e-=2)*e*e+2)+t}},{key:"easeInQuart",value:function(e,t,n,i){return n*(e/=i)*e*e*e+t}},{key:"easeOutQuart",value:function(e,t,n,i){return-n*((e=e/i-1)*e*e*e-1)+t}},{key:"easeInOutQuart",value:function(e,t,n,i){return(e/=i/2)<1?n/2*e*e*e*e+t:-n/2*((e-=2)*e*e*e-2)+t}},{key:"easeInQuint",value:function(e,t,n,i){return n*(e/=i)*e*e*e*e+t}},{key:"easeOutQuint",value:function(e,t,n,i){return n*((e=e/i-1)*e*e*e*e+1)+t}},{key:"easeInOutQuint",value:function(e,t,n,i){return(e/=i/2)<1?n/2*e*e*e*e*e+t:n/2*((e-=2)*e*e*e*e+2)+t}},{key:"easeInElastic",value:function(e,t,n,i){var a=1.70158,s=0,u=n;return 0==e?t:1==(e/=i)?t+n:(s=s||.3*i,a=u<Math.abs(n)?(u=n,s/4):0===n&&0===u?s/(2*Math.PI)*Math.asin(1):s/(2*Math.PI)*Math.asin(n/u),-(u*Math.pow(2,10*--e)*Math.sin((e*i-a)*(2*Math.PI)/s))+t)}},{key:"easeOutElastic",value:function(e,t,n,i){var a=1.70158,s=0,u=n;return 0==e?t:1==(e/=i)?t+n:(s=s||.3*i,a=u<Math.abs(n)?(u=n,s/4):0===n&&0===u?s/(2*Math.PI)*Math.asin(1):s/(2*Math.PI)*Math.asin(n/u),u*Math.pow(2,-10*e)*Math.sin((e*i-a)*(2*Math.PI)/s)+n+t)}},{key:"easeInOutElastic",value:function(e,t,n,i){var a=1.70158,s=0,u=n;return 0==e?t:2==(e/=i/2)?t+n:(s=s||i*(.3*1.5),a=u<Math.abs(n)?(u=n,s/4):0===n&&0===u?s/(2*Math.PI)*Math.asin(1):s/(2*Math.PI)*Math.asin(n/u),e<1?u*Math.pow(2,10*--e)*Math.sin((e*i-a)*(2*Math.PI)/s)*-.5+t:u*Math.pow(2,-10*--e)*Math.sin((e*i-a)*(2*Math.PI)/s)*.5+n+t)}},{key:"easeInBack",value:function(e,t,n,i){return n*(e/=i)*e*(2.70158*e-1.70158)+t}},{key:"easeOutBack",value:function(e,t,n,i){return n*((e=e/i-1)*e*(2.70158*e+1.70158)+1)+t}},{key:"easeInOutBack",value:function(e,t,n,i){var a=1.70158;return(e/=i/2)<1?n/2*(e*e*((1+(a*=1.525))*e-a))+t:n/2*((e-=2)*e*((1+(a*=1.525))*e+a)+2)+t}},{key:"easeInBounce",value:function(e,t,n,i){return n-this.easeOutBounce(i-e,0,n,i)+t}},{key:"easeOutBounce",value:function(e,t,n,i){return(e/=i)<1/2.75?7.5625*n*e*e+t:e<2/2.75?n*(7.5625*(e-=1.5/2.75)*e+.75)+t:e<2.5/2.75?n*(7.5625*(e-=2.25/2.75)*e+.9375)+t:n*(7.5625*(e-=2.625/2.75)*e+.984375)+t}},{key:"easeInOutBounce",value:function(e,t,n,i){return e<.5*i?.5*this.easeInBounce(2*e,0,n,i)+t:.5*this.easeOutBounce(2*e-i,0,n,i)+.5*n+t}},{key:"_clamp",value:function(e){return Math.max(1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,Math.min(e,2<arguments.length&&void 0!==arguments[2]?arguments[2]:1))}},{key:"_hexToRgb",value:function(e){return e=(e=3===(e=e.replace("#","")).length?e.replace(new RegExp("(.)","g"),"$1$1"):e).match(new RegExp("..","g")),[r._clamp(parseInt(e[0],16),0,255),r._clamp(parseInt(e[1],16),0,255),r._clamp(parseInt(e[2],16),0,255)]}},{key:"_rgbToHex",value:function(e){if(Array.isArray(e))return"#"+e.map(function(e){return Math.abs(Math.round(e)).toString(16).padStart(2,"0")}).join("")}}],(t=[{key:"_build",value:function(e,t,n,i){this.start=e,this.end=t,this.duration=n,this.easing="function"==typeof i?i:r.linear,this.events={},this.exportedValues={},this.tweening=!1,this.update=null,this.paused=!1,this.lastTime=0,this.elapsed=0}},{key:"build",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.start,n=e.end,i=e.duration,e=e.easing,e=void 0===e?r.linear:e;return this._build(void 0===t?{}:t,void 0===n?{}:n,void 0===i?1e3:i,e),this}},{key:"on",value:function(e,t){if("function"==typeof t)switch(e){case"start":case"end":case"pause":case"resume":this.events[e]=t;break;default:console.error('The event "'.concat(e,'" is not supported.'))}else console.error('The callback for event "'.concat(e,'" is not a function.'));return this}},{key:"animate",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if("function"!=typeof e)console.error("The pUpdate parameter passed to animate is not a function.");else if(!this.tweening){var n=Object.keys(this.start),i=Object.keys(this.end);if(n.length&&i.length){if(n.every(function(e){return i.includes(e)}))return this.update=e,this.tweening=!0,this.elapsed=0,this.oscillating=t,this.events.start&&this.events.start(),requestAnimationFrame(this.animationFrame),this;console.error("The end object is missing properties that the start object has.")}else console.error("The start object or the end object has no properties.")}}},{key:"resume",value:function(){return this.paused&&(this.lastTime=Date.now(),this.paused=!1,this.events.resume&&this.events.resume(),requestAnimationFrame(this.animationFrame)),this}},{key:"pause",value:function(){return this.paused||(this.paused=!0,this.events.pause&&this.events.pause()),this}},{key:"stop",value:function(){for(var e in this.tweening=!1,this.oscillating=!1,this.update=null,this.elapsed=0,this.lastTime=0,this.paused=!1,this.exportedValues)this.exportedValues.hasOwnProperty(e)&&delete this.exportedValues[e]}}])&&a(e.prototype,t),n&&a(e,n),Object.defineProperty(e,"prototype",{writable:!1}),r}()}],i={};function a(e){var t=i[e];return void 0!==t||(t=i[e]={exports:{}},n[e](t,t.exports,a)),t.exports}a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var o,d,l,h,e={};function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(t,e){var n,i=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)),i}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,p(i.key),i)}}function t(e,t,n){t&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1})}function c(e,t,n){(t=p(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}function p(e){e=function(e,t){if("object"!==s(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!==s(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}
/**
* Class for managing sounds
* @class ESoundManagerSingleton  
* @license ESound does not have a license at this time. For licensing contact the author
* @author https://github.com/doubleactii
* Copyright (c) 2023 Evitca Studio

Safari does not support .ogg files, so if you are using safari, do not use .ogg files or this library will not play that sound on safari.
Otherwise, you can use .ogg on any other platform. Cordova included. This supports mp3, wav, ogg, etc.
*/(e,"string");return"symbol"===s(e)?e:String(e)}(a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})})(e),a.d(e,{ESound:()=>l}),o=a(1),c(d=function(){function l(){var e=this;f(this,l),window.AudioContext||window.webkitAudioContext?(window.AudioContext=window.AudioContext||window.webkitAudioContext,window.addEventListener("mousedown",this.resumeAudioCtx.bind(this)),window.addEventListener("touchstart",this.resumeAudioCtx.bind(this)),window.addEventListener("load",this.resumeAudioCtx.bind(this)),window.addEventListener("blur",function(){e.focused=!1,e.soundsPlaying.length&&e.pauseAllSounds(!0)}),window.addEventListener("focus",function(){e.focused=!0,e.pausedSounds.length&&e.resumeAllSounds(!0),(e.queuedSoundsToPlay.length||e.queuedSoundsToFade.length)&&e.playQueuedSounds()}),this.audioCtx=new AudioContext,!this.audioCtx.createGain&&this.audioCtx.createGainNode&&(this.audioCtx.createGain=this.audioCtx.createGainNode),this.gainNode=this.audioCtx.createGain(),this.gainNode.gain.value=l.normalize(l.MAX_VOLUME),this.gainNode.connect(this.audioCtx.destination),this.soundsPlaying=[],this.pausedSounds=[],this.recycledSounds=[],this.queuedSoundsToPlay=[],this.queuedSoundsToFade=[],this.loadedBuffers={},this.fader={},this.volume=100,this.muted=!1,this.state=null,this.focused=!0,this.abilityToPlaySound=null):console.error("Your device does not support window.AudioContext || window.webkitAudioContext. This library cannot be used")}return t(l,[{key:"canPlaySound",value:function(){return!(this.abilityToPlaySound&&!this.abilityToPlaySound())}},{key:"enableChecker",value:function(e){return"function"==typeof e&&(this.abilityToPlaySound=e),this}},{key:"adjustVolume",value:function(e){return this.volume=l.clamp(e,l.MIN_VOLUME,l.MAX_VOLUME),this.gainNode.gain.value=l.normalize(this.volume),this}},{key:"fade",value:function(){var i,a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:100,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:5e3,s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"easeOutCubic",u=3<arguments.length?arguments[3]:void 0;if(!isNaN(a)&&(!isNaN(e)&&"fading"!==this.state))return a=l.clamp(a,l.MIN_VOLUME,l.MAX_VOLUME),o.Tween[s]||console.error("Invalid pEase value. Reverted to default."),this.state="fading",this.fader.duration=Math.max(e,0),this.fader.currentIteration=0,this.fader.initialValue=this.volume,this.fader.changeInValue=a-this.fader.initialValue,this.fader.totalIterations=this.fader.duration/(1e3/l.FRAME_RATE),this.fader.startStamp=null,this.fader.previousTimeStamp=null,this.fader.durationOffScreen=[0,0],(i=this).fader.raf=requestAnimationFrame(function e(t){var n;i.focused?(null===i.fader.startStamp&&(i.fader.startStamp=t),i.adjustVolume(o.Tween[s](i.fader.currentIteration,i.fader.initialValue,i.fader.changeInValue,i.fader.totalIterations)),i.fader.durationOffScreen[1]&&(i.fader.durationOffScreen[0]+=i.fader.durationOffScreen[1],i.fader.durationOffScreen[1]=0),n=t-i.fader.durationOffScreen[0]-i.fader.startStamp,i.fader.currentIteration<i.fader.totalIterations&&i.fader.currentIteration++,n<i.fader.duration?(i.fader.previousTimeStamp=t,i.fader.raf=requestAnimationFrame(e)):(cancelAnimationFrame(i.fader.raf),i.fader.duration=i.fader.currentIteration=i.fader.initialValue=i.fader.changeInValue=i.fader.totalIterations=i.fader.startStamp=i.fader.previousTimeStamp=i.fader.durationOffScreen=i.fader.raf=null,i.state=null,i.adjustVolume(a),"function"==typeof u&&u())):(i.fader.raf=requestAnimationFrame(e),i.fader.durationOffScreen[1]=t-i.fader.previousTimeStamp)}),this}},{key:"toggleMute",value:function(){return this.muted=!this.muted,this.muted?(this._previousGainNodeValue=this.gainNode.gain.value,this.gainNode.gain.value=0):this.gainNode.gain.value=this._previousGainNodeValue||1,this}},{key:"isMuted",value:function(){return this.muted}},{key:"emit",value:function(t){var n,i,a,s,u=1<arguments.length&&void 0!==arguments[1]?arguments[1]:100,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,r=3<arguments.length?arguments[3]:void 0,d=4<arguments.length&&void 0!==arguments[4]?arguments[4]:1;if(this.canPlaySound())return(i=(n=this).audioCtx.createBufferSource()).kill=function(){this.buffer?this.stop():this.queuedToStop=!0},a=function(){var e=n.audioCtx.createGain();e.gain.value=l.normalize(l.clamp(u,l.MIN_VOLUME,l.MAX_VOLUME)),e.connect(n.gainNode),i.connect(e),i.buffer=n.loadedBuffers[t],i.playbackRate.value=d,i.start||(i.start=i.noteOn),i.start(0,o,r||i.buffer.duration)},this.loadedBuffers[t]?a():((s=new XMLHttpRequest).open("GET",t),s.responseType="arraybuffer",s.onload=function(){var e=s.response;n.audioCtx.decodeAudioData(e,function(e){n.loadedBuffers[t]=e,i.queuedToStop||a()},function(e){console.error('Error with decoding audio data "'.concat(t,'"'))})},s.send()),i}},{key:"createSound",value:function(e,t,n,i,a,s,u,o){var r;return this.recycledSounds.length?((r=this.recycledSounds.pop()).build(e,t,n,i,a,s,u,o),r):new h(e,t,n,i,a,s,u,o)}},{key:"stopAllSounds",value:function(e){for(var t=this.soundsPlaying.length-1;0<=t;t--){var n=this.soundsPlaying[t];Array.isArray(e)&&e.includes(n)||n.stop()}return this}},{key:"killAllSounds",value:function(){for(var e=this.soundsPlaying.length-1;0<=e;e--)this.soundsPlaying[e].kill();return this}},{key:"pauseAllSounds",value:function(e){for(var t=this.soundsPlaying.length-1;0<=t;t--){var n=this.soundsPlaying[t];e&&n.canPlayUnfocused()||n.pause()}return this}},{key:"resumeAllSounds",value:function(e){for(var t=this.pausedSounds.length-1;0<=t;t--)this.pausedSounds[t].resume();return this}},{key:"playQueuedSounds",value:function(){for(var e=this.queuedSoundsToPlay.length-1;0<=e;e--){var t=this.queuedSoundsToPlay[e];this.queuedSoundsToPlay.splice(e,1),t.play()}for(var n=this.queuedSoundsToFade.length-1;0<=n;n--){var i=this.queuedSoundsToFade[n];this.queuedSoundsToFade.splice(n,1),i.queuedFade()}}},{key:"unloadSound",value:function(e){return this.loadedBuffers[e]&&delete this.loadedBuffers[e],this}},{key:"recycleSound",value:function(e){return e instanceof h&&e.kill(),this}},{key:"resumeAudioCtx",value:function(){"running"!==this.audioCtx.state&&this.audioCtx.resume().then(function(){},function(){}),this.ready=!0}}]),l}(),"MAX_VOLUME",200),c(d,"MIN_VOLUME",-200),c(d,"MAX_RECYCLED_SOUNDS",500),c(d,"MAX_PLAYBACK_RATE",10),c(d,"FRAME_RATE",60),c(d,"clamp",function(e,t,n){return Math.max(t,Math.min(e,n))}),c(d,"normalize",function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return(e-t)/((2<arguments.length&&void 0!==arguments[2]?arguments[2]:100)-t)*(3<arguments.length&&void 0!==arguments[3]?arguments[3]:1)}),l=new d,h=function(){function r(e,t,n,i,a,s,u,o){f(this,r),this.soundPath=null,this.startTime=null,this.endTime=null,this.save=null,this.duration=null,this.source=null,this.gainNode=null,this.loaded=!1,this.playAfterLoad=!1,this.muted=!1,this.state=null,this.startedTimeStamp=null,this.pausedTimeStamp=0,this.playUnfocused=null,this.fader={},this.events={},this.stopSignal=!1,this._loop=!1,this._playbackRate=1,this._volume=100,this._info={soundPath:null,duration:null},this.build(e,t,n,i,a,s,u,o)}return t(r,[{key:"volume",get:function(){return this._volume},set:function(e){this._volume=d.clamp(e,d.MIN_VOLUME,d.MAX_VOLUME),this.loaded&&(this.gainNode.gain.value=d.normalize(this._volume))}},{key:"on",value:function(e,t){if("function"==typeof t)switch(e){case"start":case"stop":case"end":case"pause":case"resume":this.events[e]=t;break;default:console.error('The event "'.concat(e,'" is not supported.'))}else console.error('The callback for event "'.concat(e,'" is not a function.'));return this}},{key:"toggleMute",value:function(){if(this.loaded&&this.source)return this.muted=!this.muted,this.muted?this.gainNode.gain.value=0:this.gainNode.gain.value=d.normalize(this._volume),this}},{key:"loop",get:function(){return this._loop},set:function(e){this._loop=!!e,this.source&&(this.source.loop=this._loop)}},{key:"toggleLoop",value:function(){return this._loop=!this._loop,this.source&&(this.source.loop=this._loop),this}},{key:"playbackRate",get:function(){return this._playbackRate},set:function(e){this._playbackRate=d.clamp(e,1,d.MAX_PLAYBACK_RATE),this.source&&(this.source.playbackRate.value=this._playbackRate)}},{key:"info",get:function(){return this.loaded&&this.source&&(this._info.duration=this.duration),this._info.soundPath=this.soundPath,function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?u(Object(n),!0).forEach(function(e){c(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}({},this._info)},set:function(e){this._info=this._info}},{key:"build",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:100,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,a=4<arguments.length&&void 0!==arguments[4]&&arguments[4],s=5<arguments.length&&void 0!==arguments[5]&&arguments[5],u=6<arguments.length&&void 0!==arguments[6]?arguments[6]:1,o=7<arguments.length&&void 0!==arguments[7]&&arguments[7];this.soundPath=e,this.startTime=Math.max(n,0),this.endTime=Math.max(i,0),this.save=!!o||a,this._playbackRate=d.clamp(u,1,d.MAX_PLAYBACK_RATE),this.playUnfocused=!!s,this.state=null,this._loop=!!o,this._volume=d.clamp(t,d.MIN_VOLUME,d.MAX_VOLUME),l.loadedBuffers[this.soundPath]?this.loaded=!0:this.load()}},{key:"load",value:function(){var t=new XMLHttpRequest,n=this;t.open("GET",n.soundPath),t.responseType="arraybuffer",t.onload=function(){var e=t.response;l.audioCtx.decodeAudioData(e,function(e){n.loaded=!0,l.loadedBuffers[n.soundPath]=e,n.playAfterLoad&&(n.stopSignal?n.stopSignal=!1:n.play())},function(e){n.loaded=!1,console.error('Error with decoding audio data "'.concat(n.soundPath,'" This sound has been killed.')),n.kill()})},t.send()}},{key:"pause",value:function(){if(this.loaded)return this.stop("suspended"),this.state="suspended",this.pausedTimeStamp=l.audioCtx.currentTime-this.startedTimeStamp,l.soundsPlaying.includes(this)&&l.soundsPlaying.splice(l.soundsPlaying.indexOf(this),1),l.pausedSounds.includes(this)||l.pausedSounds.push(this),"function"==typeof this.events.pause&&this.events.pause(),this}},{key:"resume",value:function(){if(this.loaded)return l.pausedSounds.includes(this)&&l.pausedSounds.splice(l.pausedSounds.indexOf(this),1),l.soundsPlaying.includes(this)||l.soundsPlaying.push(this),this.play(!0),this.state=this.fader.raf?"fading":"playing","function"==typeof this.events.resume&&this.events.resume(),this}},{key:"stop",value:function(e){var t;if(this.source)return t="playing"===this.state||"fading"===this.state||"suspended"===this.state,l.soundsPlaying.includes(this)&&l.soundsPlaying.splice(l.soundsPlaying.indexOf(this),1),this.source&&(this.source.stop||(this.source.stop=this.source.noteOff),this.source.stop(),this.source.disconnect(),this.gainNode.disconnect(),this.source=null,this.gainNode=null),this.state=e||"stopped","stopped"===this.state&&t&&"function"==typeof this.events.stop&&this.events.stop(),this;this.stopSignal=!0}},{key:"play",value:function(e){if(this.soundPath&&"recycled"!==this.state&&l.canPlaySound())if(this.loaded||l.loadedBuffers[this.soundPath]){var t,n,i;if(l.focused||this.canPlayUnfocused())return this.source&&(this.source.disconnect(),this.gainNode.disconnect(),this.source=null,this.gainNode=null),l.pausedSounds.includes(this)&&l.pausedSounds.splice(l.pausedSounds.indexOf(this),1),t=l.audioCtx.createBufferSource(),(n=l.audioCtx.createGain()).gain.value=d.normalize((i=this)._volume),n.connect(l.gainNode),t.connect(n),t.buffer=l.loadedBuffers[this.soundPath],t.playbackRate.value=this._playbackRate,t.onended=function(){"stopped"===i.state&&i.save||("restart"===i.state?i.play():"suspended"!==i.state&&("stopped"!==i.state&&"function"==typeof i.events.end&&i.events.end(),i._loop?i.play():i.save||i.kill()))},this.source=t,this.gainNode=n,this.duration=t.buffer.duration,this.playAfterLoad=null,t.start||(t.start=t.noteOn),t.start(0,this.pausedTimeStamp?this.pausedTimeStamp*this._playbackRate:this.startTime,this.endTime||this.duration),this.state="playing",this.startedTimeStamp=l.audioCtx.currentTime-(this.pausedTimeStamp||this.startTime),this.pausedTimeStamp=0,l.soundsPlaying.includes(this)||l.soundsPlaying.push(this),e||"function"!=typeof this.events.start||this.events.start(),this;l.queuedSoundsToPlay.includes(this)||l.queuedSoundsToPlay.push(this)}else this.playAfterLoad=!0}},{key:"restart",value:function(){return this.stop("restart"),this}},{key:"canPlayUnfocused",value:function(){return!!this.playUnfocused}},{key:"kill",value:function(){if(this.wipe(),l.recycledSounds.length<d.MAX_RECYCLED_SOUNDS)l.recycledSounds.push(this);else for(var e in this)delete this[e]}},{key:"wipe",value:function(){for(var e in this.onStarted=null,this.onStopped=null,this.onEnded=null,this.onSuspended=null,this.onResumed=null,this.stop("wipe"),cancelAnimationFrame(this.fader.raf),this.source&&(this.source.disconnect(),this.gainNode.disconnect()),this.soundPath=null,this.startTime=null,this.endTime=null,this.save=null,this.duration=null,this._playbackRate=1,this.source=null,this.gainNode=null,this.loaded=!1,this.playAfterLoad=null,this.state="recycled",this.startedTimeStamp=null,this.pausedTimeStamp=0,this.playUnfocused=null,this.fader.duration=this.fader.currentIteration=this.fader.initialValue=this.fader.changeInValue=this.fader.totalIterations=this.fader.startStamp=this.fader.previousTimeStamp=this.fader.durationOffScreen=this.fader.queue=this.fader.raf=null,this.stopSignal=!1,this._loop=!1,this._volume=100,this._info.soundPath=this._info.duration=null,this.events)delete this.events[e];l.soundsPlaying.includes(this)&&l.soundsPlaying.splice(l.soundsPlaying.indexOf(this),1),l.pausedSounds.includes(this)&&l.pausedSounds.splice(l.pausedSounds.indexOf(this),1),l.queuedSoundsToPlay.includes(this)&&l.queuedSoundsToPlay.splice(l.queuedSoundsToPlay.indexOf(this),1),l.queuedSoundsToFade.includes(this)&&l.queuedSoundsToFade.splice(l.queuedSoundsToFade.indexOf(this),1)}},{key:"getCurrentTime",value:function(){return this.pausedTimeStamp?this.pausedTimeStamp*this._playbackRate:this.startedTimeStamp?l.audioCtx.currentTime-this.startedTimeStamp:0}},{key:"fade",value:function(){var i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:100,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:5e3,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"easeOutCubic",s=3<arguments.length?arguments[3]:void 0;if(!isNaN(i)&&!(isNaN(e)||"playing"!==this.state&&l.focused)){if(!l.focused&&!this.canPlayUnfocused())return l.queuedSoundsToFade.includes(this)?void 0:(this.fader.queue={volume:i,duration:e,ease:a,callback:s},void l.queuedSoundsToFade.push(this));o.Tween[a]||(a="easeOutCubic",console.warn("ESound: Invalid pEase value. Reverted to default.")),this.fader.queue&&(this.fader.queue=null),i=d.clamp(i,d.MIN_VOLUME,d.MAX_VOLUME),this.fader.duration=Math.max(e,0),this.fader.currentIteration=0,this.fader.initialValue=this._volume,this.fader.changeInValue=i-this.fader.initialValue,this.fader.totalIterations=this.fader.duration/(1e3/d.FRAME_RATE),this.fader.startStamp=null,this.fader.previousTimeStamp=null,this.fader.durationOffScreen=[0,0],this.state="fading";var u=this;return this.fader.raf=requestAnimationFrame(function e(t){var n;l.focused?(null===u.fader.startStamp&&(u.fader.startStamp=t),u.volume=o.Tween[a](u.fader.currentIteration,u.fader.initialValue,u.fader.changeInValue,u.fader.totalIterations),u.fader.durationOffScreen[1]&&(u.fader.durationOffScreen[0]+=u.fader.durationOffScreen[1],u.fader.durationOffScreen[1]=0),n=t-u.fader.durationOffScreen[0]-u.fader.startStamp,u.fader.currentIteration<u.fader.totalIterations&&u.fader.currentIteration++,n<u.fader.duration?(u.fader.previousTimeStamp=t,u.fader.raf=requestAnimationFrame(e)):(cancelAnimationFrame(u.fader.raf),u.fader.duration=u.fader.currentIteration=u.fader.initialValue=u.fader.changeInValue=u.fader.totalIterations=u.fader.startStamp=u.fader.previousTimeStamp=u.fader.durationOffScreen=u.fader.queue=u.fader.raf=null,u.state="playing",u.volume=i,"function"==typeof s&&s())):(u.fader.raf=requestAnimationFrame(e),u.fader.durationOffScreen[1]=t-u.fader.previousTimeStamp)}),this}}},{key:"queuedFade",value:function(){this.fader.queue&&this.fade(this.fader.queue.volume,this.fader.queue.duration,this.fader.queue.ease,this.fader.queue.callback)}}]),r}();e=e.ESound;export{e as ESound};