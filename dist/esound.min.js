'use strict';(()=>{const u=setInterval(()=>{VYLO.Client&&(clearInterval(u),v())}),v=()=>{if(window.AudioContext||window.webkitAudioContext){var m=(a,b=0,c=100,d=1)=>(a-b)/(c-b)*d,q={linear:function(a,b,c,d){return c*a/d+b},easeInQuad:function(a,b,c,d){return c*(a/=d)*a+b},easeOutQuad:function(a,b,c,d){return-c*(a/=d)*(a-2)+b},easeInOutQuad:function(a,b,c,d){return 1>(a/=d/2)?c/2*a*a+b:-c/2*(--a*(a-2)-1)+b},easeInSine:function(a,b,c,d){return-c*Math.cos(a/d*(Math.PI/2))+c+b},easeOutSine:function(a,
b,c,d){return c*Math.sin(a/d*(Math.PI/2))+b},easeInOutSine:function(a,b,c,d){return-c/2*(Math.cos(Math.PI*a/d)-1)+b},easeInExpo:function(a,b,c,d){return 0==a?b:c*Math.pow(2,10*(a/d-1))+b},easeOutExpo:function(a,b,c,d){return a==d?b+c:c*(-Math.pow(2,-10*a/d)+1)+b},easeInOutExpo:function(a,b,c,d){return 0==a?b:a==d?b+c:1>(a/=d/2)?c/2*Math.pow(2,10*(a-1))+b:c/2*(-Math.pow(2,-10*--a)+2)+b},easeInCirc:function(a,b,c,d){return-c*(Math.sqrt(1-(a/=d)*a)-1)+b},easeOutCirc:function(a,b,c,d){return c*Math.sqrt(1-
(a=a/d-1)*a)+b},easeInOutCirc:function(a,b,c,d){return 1>(a/=d/2)?-c/2*(Math.sqrt(1-a*a)-1)+b:c/2*(Math.sqrt(1-(a-=2)*a)+1)+b},easeInCubic:function(a,b,c,d){return c*(a/=d)*a*a+b},easeOutCubic:function(a,b,c,d){return c*((a=a/d-1)*a*a+1)+b},easeInOutCubic:function(a,b,c,d){return 1>(a/=d/2)?c/2*a*a*a+b:c/2*((a-=2)*a*a+2)+b},easeInQuart:function(a,b,c,d){return c*(a/=d)*a*a*a+b},easeOutQuart:function(a,b,c,d){return-c*((a=a/d-1)*a*a*a-1)+b},easeInOutQuart:function(a,b,c,d){return 1>(a/=d/2)?c/2*a*
a*a*a+b:-c/2*((a-=2)*a*a*a-2)+b},easeInQuint:function(a,b,c,d){return c*(a/=d)*a*a*a*a+b},easeOutQuint:function(a,b,c,d){return c*((a=a/d-1)*a*a*a*a+1)+b},easeInOutQuint:function(a,b,c,d){return 1>(a/=d/2)?c/2*a*a*a*a*a+b:c/2*((a-=2)*a*a*a*a+2)+b},easeInElastic:function(a,b,c,d){var e=0,g=c;if(0==a)return b;if(1==(a/=d))return b+c;e||(e=.3*d);g<Math.abs(c)?(g=c,c=e/4):c=e/(2*Math.PI)*Math.asin(c/g);return-(g*Math.pow(2,10*--a)*Math.sin(2*(a*d-c)*Math.PI/e))+b},easeOutElastic:function(a,b,c,d){var e=
0,g=c;if(0==a)return b;if(1==(a/=d))return b+c;e||(e=.3*d);if(g<Math.abs(c)){g=c;var h=e/4}else h=e/(2*Math.PI)*Math.asin(c/g);return g*Math.pow(2,-10*a)*Math.sin(2*(a*d-h)*Math.PI/e)+c+b},easeInOutElastic:function(a,b,c,d){var e=0,g=c;if(0==a)return b;if(2==(a/=d/2))return b+c;e||(e=.3*d*1.5);if(g<Math.abs(c)){g=c;var h=e/4}else h=e/(2*Math.PI)*Math.asin(c/g);return 1>a?-.5*g*Math.pow(2,10*--a)*Math.sin(2*(a*d-h)*Math.PI/e)+b:g*Math.pow(2,-10*--a)*Math.sin(2*(a*d-h)*Math.PI/e)*.5+c+b},easeInBack:function(a,
b,c,d){return c*(a/=d)*a*(2.70158*a-1.70158)+b},easeOutBack:function(a,b,c,d){return c*((a=a/d-1)*a*(2.70158*a+1.70158)+1)+b},easeInOutBack:function(a,b,c,d){var e=1.70158;return 1>(a/=d/2)?c/2*a*a*(((e*=1.525)+1)*a-e)+b:c/2*((a-=2)*a*(((e*=1.525)+1)*a+e)+2)+b},easeInBounce:function(a,b,c,d){return c-this.easeOutBounce(d-a,0,c,d)+b},easeOutBounce:function(a,b,c,d){a/=d;if(a<1/2.75)return 7.5625*c*a*a+b;if(a<2/2.75)return a-=1.5/2.75,c*(7.5625*a*a+.75)+b;if(a<2.5/2.75)return a-=2.25/2.75,c*(7.5625*
a*a+.9375)+b;a-=2.625/2.75;return c*(7.5625*a*a+.984375)+b},easeInOutBounce:function(a,b,c,d){return a<.5*d?.5*this.easeInBounce(2*a,0,c,d)+b:.5*this.easeOutBounce(2*a-d,0,c,d)+.5*c+b}},r="linear easeInQuad easeOutQuad easeInOutQuad easeInSine easeOutSine easeInOutSine easeInExpo easeOutExpo easeInOutExpo easeInCirc easeOutCirc easeInOutCirc easeInCubic easeOutCubic easeInOutCubic easeInQuart easeOutQuart easeInOutQuart easeInQuint easeOutQuint easeInOutQuint easeInElastic easeOutElastic easeInOutElastic easeInBack easeOutBack easeInOutBack easeInBounce easeOutBounce easeInOutBounce".split(" "),
f={};VYLO.global.ESound=f;window.ESound=f;window.AudioContext=window.AudioContext||window.webkitAudioContext;f.audioCtx=new AudioContext;f.audioCtx.createGain||(f.audioCtx.createGain=f.audioCtx.createGainNode);f.gainNode=f.audioCtx.createGain();f.gainNode.gain.value=m(200);f.gainNode.connect(f.audioCtx.destination);f.soundsPlaying=[];f.suspendedSounds=[];f.recycledSounds=[];f.queuedSoundsToPlay=[];f.queuedSoundsToFade=[];f.loadedBuffers={};f.fader={};f.volume=100;f.muted=!1;f.state=null;f.focused=
!0;f.canPlaySound=function(){return"function"!==typeof VYLO.Client.canPlaySound||VYLO.Client.canPlaySound()?!0:!1};f.adjustVolume=function(a){this.volume=Math.max(-200,Math.min(a,200));this.gainNode.gain.value=m(this.volume)};f.fade=function(a,b=5,c="easeOutCubic",d){if(!isNaN(a)&&!isNaN(b)&&"fading"!==this.state){a=Math.max(-200,Math.min(a,200));r.includes(c)||(c="easeOutCubic",console.warn("ESound['fade'] Invalid pEase value. Reverted to default."));this.state="fading";this.fader.duration=Math.max(b,
0);this.fader.currentIteration=0;this.fader.initialValue=this.volume;this.fader.changeInValue=a-this.fader.initialValue;this.fader.totalIterations=60*this.fader.duration;this.fader.startStamp=null;this.fader.previousTimeStamp=null;this.fader.durationOffScreen=[0,0];var e=this,g=function(h){if(e.focused){null===e.fader.startStamp&&(e.fader.startStamp=h);e.adjustVolume(q[c](e.fader.currentIteration,e.fader.initialValue,e.fader.changeInValue,e.fader.totalIterations));e.fader.durationOffScreen[1]&&(e.fader.durationOffScreen[0]+=
e.fader.durationOffScreen[1],e.fader.durationOffScreen[1]=0);var l=h-e.fader.durationOffScreen[0]-e.fader.startStamp;e.fader.currentIteration<e.fader.totalIterations&&e.fader.currentIteration++;l<1E3*e.fader.duration?(e.fader.previousTimeStamp=h,e.fader.raf=requestAnimationFrame(g)):(cancelAnimationFrame(e.fader.raf),e.fader.duration=e.fader.currentIteration=e.fader.initialValue=e.fader.changeInValue=e.fader.totalIterations=e.fader.startStamp=e.fader.previousTimeStamp=e.fader.durationOffScreen=e.fader.raf=
null,e.state=null,e.adjustVolume(a),d&&d())}else e.fader.raf=requestAnimationFrame(g),e.fader.durationOffScreen[1]=h-e.fader.previousTimeStamp};this.fader.raf=requestAnimationFrame(g)}};f.toggleMute=function(){(this.muted=this.muted?!1:!0)?(this._previousGainNodeValue=this.gainNode.gain.value,this.gainNode.gain.value=0):this.gainNode.gain.value=this._previousGainNodeValue?this._previousGainNodeValue:1};f.isMuted=function(){return this.muted};f.emit=function(a,b=100,c=0,d,e=1){if(f.canPlaySound()){var g=
this,h=g.audioCtx.createBufferSource();h.kill=function(){this.buffer?this.stop():this.queuedToStop=!0};var l=function(){const k=g.audioCtx.createGain();k.gain.value=m(Math.max(-200,Math.min(b,200)));k.connect(g.gainNode);h.connect(k);h.buffer=g.loadedBuffers[a];h.playbackRate.value=e;h.start||(h.start=h.noteOn);h.start(0,c,d?d:h.buffer.duration)};if(this.loadedBuffers[a])l();else{const k=new XMLHttpRequest;k.open("GET",VYLO.Resource.getResourcePath("sound",a));k.responseType="arraybuffer";k.onload=
function(){g.audioCtx.decodeAudioData(k.response,n=>{g.loadedBuffers[a]=n;h.queuedToStop||l()},n=>{console.error("Error with decoding audio data: "+a+" path: "+VYLO.Resource.getResourcePath("sound",a))})};k.send()}return h}};f.createSound=function(a,b,c,d,e,g,h,l,k){if(this.recycledSounds.length){const n=this.recycledSounds.pop();n.build(a,b,c,d,e,g,h,l,k);return n}return new t(a,b,c,d,e,g,h,l,k)};f.stopAllSounds=function(a){for(let b=this.soundsPlaying.length-1;0<=b;b--){const c=this.soundsPlaying[b];
a&&a.constructor===Array&&a.includes(c)||c.stop()}};f.killAllSounds=function(){for(let a=this.soundsPlaying.length-1;0<=a;a--)this.soundsPlaying[a].kill()};f.suspendAllSounds=function(a){for(let b=this.soundsPlaying.length-1;0<=b;b--){const c=this.soundsPlaying[b];a&&c.getFocusStatus()||c.suspend()}};f.resumeAllSounds=function(a){for(a=this.suspendedSounds.length-1;0<=a;a--)this.suspendedSounds[a].resume()};f.playQueuedSounds=function(){for(var a=this.queuedSoundsToPlay.length-1;0<=a;a--){var b=this.queuedSoundsToPlay[a];
this.queuedSoundsToPlay.splice(a,1);b.play()}for(a=this.queuedSoundsToFade.length-1;0<=a;a--)b=this.queuedSoundsToFade[a],this.queuedSoundsToFade.splice(a,1),b.queuedFade()};f.unloadSound=function(a){this.loadedBuffers[a]&&delete this.loadedBuffers[a]};f.recycleSound=function(a){a instanceof t&&a.kill()};class t{constructor(a,b,c,d,e,g,h,l,k){this.gainNode=this.source=this.duration=this.save=this.endTime=this.startTime=this.soundName=null;this.muted=this.playAfterLoad=this.loaded=!1;this.startedTimeStamp=
this.state=null;this.suspendedTimeStamp=0;this.playUnfocused=null;this.fader={};this._loop=this.stopSignal=!1;this._playbackRate=1;this._volume=100;this._info={soundName:null,duration:null};this.build(a,b,c,d,e,g,h,l,k)}get volume(){return this._volume}set volume(a){this._volume=Math.max(-200,Math.min(a,200));this.loaded&&(this.gainNode.gain.value=m(this._volume))}toggleMute(){this.loaded&&this.source&&(this.muted=this.muted?!1:!0,this.gainNode.gain.value=this.muted?0:m(this._volume))}get loop(){return this._loop}set loop(a){this._loop=
a?!0:!1;this.source&&(this.source.loop=this._loop)}toggleLoop(){this._loop=this._loop?!1:!0;this.source&&(this.source.loop=this._loop)}get playbackRate(){return this._playbackRate}set playbackRate(a){this._playbackRate=Math.max(1,Math.min(a,10));this.source&&(this.source.playbackRate.value=this._playbackRate)}set info(a){this._info=this._info}get info(){this.loaded&&this.source&&(this._info.duration=this.duration);this._info.soundName=this.soundName;return this._info}build(a,b=100,c=0,d=0,e=!1,g=
!1,h=1,l=!1,k){this.soundName=a;this.startTime=Math.max(c,0);this.endTime=Math.max(d,0);this.save=l?!0:e;this._playbackRate=Math.max(1,Math.min(h,10));this.playUnfocused=g?!0:!1;this.state=null;this._loop=l?!0:!1;this._volume=Math.max(-200,Math.min(b,200));k&&k.constructor===Object?("function"===typeof k.onStarted&&(this.onStarted=k.onStarted.bind(this)),"function"===typeof k.onStopped&&(this.onStopped=k.onStopped.bind(this)),"function"===typeof k.onEnded&&(this.onEnded=k.onEnded.bind(this)),"function"===
typeof k.onSuspended&&(this.onSuspended=k.onSuspended.bind(this)),"function"===typeof k.onResumed&&(this.onResumed=k.onResumed.bind(this))):k&&k.constructor!==Object&&console.warn("ESound Library: Invalid variable type passed for pCallbackObject.");f.loadedBuffers[this.soundName]?this.loaded=!0:this.load()}load(){const a=new XMLHttpRequest,b=this;a.open("GET",VYLO.Resource.getResourcePath("sound",b.soundName));a.responseType="arraybuffer";a.onload=function(){f.audioCtx.decodeAudioData(a.response,
c=>{b.loaded=!0;f.loadedBuffers[b.soundName]=c;b.playAfterLoad&&(b.stopSignal?b.stopSignal=!1:b.play())},c=>{b.loaded=!1;console.error("Error with decoding audio data: "+b.soundName+" path: "+VYLO.Resource.getResourcePath("sound",b.soundName)+" This sound has been killed.");b.kill()})};a.send()}suspend(){if(this.loaded&&(this.stop("suspended"),this.state="suspended",this.suspendedTimeStamp=f.audioCtx.currentTime-this.startedTimeStamp,f.soundsPlaying.includes(this)&&f.soundsPlaying.splice(f.soundsPlaying.indexOf(this),
1),f.suspendedSounds.includes(this)||f.suspendedSounds.push(this),"function"===typeof this.onSuspended))this.onSuspended()}resume(){if(this.loaded&&(f.suspendedSounds.includes(this)&&f.suspendedSounds.splice(f.suspendedSounds.indexOf(this),1),f.soundsPlaying.includes(this)||f.soundsPlaying.push(this),this.play(!0),this.state=this.fader.raf?"fading":"playing","function"===typeof this.onResumed))this.onResumed()}stop(a){if(this.source){var b="playing"===this.state||"fading"===this.state||"suspended"===
this.state?!0:!1;f.soundsPlaying.includes(this)&&f.soundsPlaying.splice(f.soundsPlaying.indexOf(this),1);this.source&&(this.source.stop||(this.source.stop=this.source.noteOff),this.source.stop(),this.source.disconnect(),this.gainNode.disconnect(),this.gainNode=this.source=null);this.state=a?a:"stopped";if("stopped"===this.state&&b&&"function"===typeof this.onStopped)this.onStopped()}else this.stopSignal=!0}play(a){if(this.soundName&&"recycled"!==this.state&&f.canPlaySound())if(this.loaded||f.loadedBuffers[this.soundName])if(f.focused||
this.playUnfocused){this.source&&(this.source.disconnect(),this.gainNode.disconnect(),this.gainNode=this.source=null);f.suspendedSounds.includes(this)&&f.suspendedSounds.splice(f.suspendedSounds.indexOf(this),1);var b=f.audioCtx.createBufferSource(),c=f.audioCtx.createGain(),d=this;c.gain.value=m(this._volume);c.connect(f.gainNode);b.connect(c);b.buffer=f.loadedBuffers[this.soundName];b.playbackRate.value=this._playbackRate;b.onended=function(){if("stopped"!==d.state||!d.save)if("restart"===d.state)d.play();
else if("suspended"!==d.state){if("stopped"!==d.state&&"function"===typeof d.onEnded)d.onEnded();d._loop?d.play():d.save||d.kill()}};this.source=b;this.gainNode=c;this.duration=b.buffer.duration;this.playAfterLoad=null;b.start||(b.start=b.noteOn);b.start(0,this.suspendedTimeStamp?this.suspendedTimeStamp*this._playbackRate:this.startTime,this.endTime?this.endTime:this.duration);this.state="playing";this.startedTimeStamp=f.audioCtx.currentTime-(this.suspendedTimeStamp?this.suspendedTimeStamp:this.startTime);
this.suspendedTimeStamp=0;f.soundsPlaying.includes(this)||f.soundsPlaying.push(this);if(!a&&"function"===typeof this.onStarted)this.onStarted()}else f.queuedSoundsToPlay.includes(this)||f.queuedSoundsToPlay.push(this);else this.playAfterLoad=!0}restart(){this.stop("restart")}getFocusStatus(){return this.playUnfocused?!0:!1}kill(){this.wipe();if(100>f.recycledSounds.length)f.recycledSounds.push(this);else for(const a in this)delete this[a]}wipe(){this.onResumed=this.onSuspended=this.onEnded=this.onStopped=
this.onStarted=null;this.stop("wipe");cancelAnimationFrame(this.fader.raf);this.source&&(this.source.disconnect(),this.gainNode.disconnect());this.duration=this.save=this.endTime=this.startTime=this.soundName=null;this._playbackRate=1;this.gainNode=this.source=null;this.loaded=!1;this.playAfterLoad=null;this.state="recycled";this.startedTimeStamp=null;this.suspendedTimeStamp=0;this.playUnfocused=null;this.fader.duration=this.fader.currentIteration=this.fader.initialValue=this.fader.changeInValue=
this.fader.totalIterations=this.fader.startStamp=this.fader.previousTimeStamp=this.fader.durationOffScreen=this.fader.queue=this.fader.raf=null;this._loop=this.stopSignal=!1;this._volume=100;this._info.soundName=this._info.duration=null;f.soundsPlaying.includes(this)&&f.soundsPlaying.splice(f.soundsPlaying.indexOf(this),1);f.suspendedSounds.includes(this)&&f.suspendedSounds.splice(f.suspendedSounds.indexOf(this),1);f.queuedSoundsToPlay.includes(this)&&f.queuedSoundsToPlay.splice(f.queuedSoundsToPlay.indexOf(this),
1);f.queuedSoundsToFade.includes(this)&&f.queuedSoundsToFade.splice(f.queuedSoundsToFade.indexOf(this),1)}getCurrentTime(){return this.suspendedTimeStamp?this.suspendedTimeStamp*this._playbackRate:this.startedTimeStamp?f.audioCtx.currentTime-this.startedTimeStamp:0}fade(a,b=5,c="easeOutCubic",d){if(!(isNaN(a)||isNaN(b)||"playing"!==this.state&&f.focused))if(f.focused||this.playUnfocused){r.includes(c)||(c="easeOutCubic",console.warn("ESound: Invalid pEase value. Reverted to default."));this.fader.queue&&
(this.fader.queue=null);a=Math.max(-200,Math.min(a,200));this.fader.duration=Math.max(b,0);this.fader.currentIteration=0;this.fader.initialValue=this._volume;this.fader.changeInValue=a-this.fader.initialValue;this.fader.totalIterations=60*this.fader.duration;this.fader.startStamp=null;this.fader.previousTimeStamp=null;this.fader.durationOffScreen=[0,0];this.state="fading";var e=this,g=function(h){if(f.focused){null===e.fader.startStamp&&(e.fader.startStamp=h);e.volume=q[c](e.fader.currentIteration,
e.fader.initialValue,e.fader.changeInValue,e.fader.totalIterations);e.fader.durationOffScreen[1]&&(e.fader.durationOffScreen[0]+=e.fader.durationOffScreen[1],e.fader.durationOffScreen[1]=0);var l=h-e.fader.durationOffScreen[0]-e.fader.startStamp;e.fader.currentIteration<e.fader.totalIterations&&e.fader.currentIteration++;l<1E3*e.fader.duration?(e.fader.previousTimeStamp=h,e.fader.raf=requestAnimationFrame(g)):(cancelAnimationFrame(e.fader.raf),e.fader.duration=e.fader.currentIteration=e.fader.initialValue=
e.fader.changeInValue=e.fader.totalIterations=e.fader.startStamp=e.fader.previousTimeStamp=e.fader.durationOffScreen=e.fader.queue=e.fader.raf=null,e.state="playing",e.volume=a,d&&d())}else e.fader.raf=requestAnimationFrame(g),e.fader.durationOffScreen[1]=h-e.fader.previousTimeStamp};this.fader.raf=requestAnimationFrame(g)}else f.queuedSoundsToFade.includes(this)||(this.fader.queue={volume:a,duration:b,ease:c,callback:d},f.queuedSoundsToFade.push(this))}queuedFade(){this.fader.queue&&this.fade(this.fader.queue.volume,
this.fader.queue.duration,this.fader.queue.ease,this.fader.queue.callback)}}var p=()=>{"running"!==f.audioCtx.state&&f.audioCtx.resume().then(()=>{},()=>{});f.ready=!0};window.addEventListener("mousedown",p);window.addEventListener("touchstart",p);EListener.on(VYLO.Client,"onWindowBlur",function(){f.focused=!1;f.soundsPlaying.length&&f.suspendAllSounds(!0)});EListener.on(VYLO.Client,"onWindowFocus",function(){f.focused=!0;f.suspendedSounds.length&&f.resumeAllSounds(!0);(f.queuedSoundsToPlay.length||
f.queuedSoundsToFade.length)&&f.playQueuedSounds()});EListener.on(VYLO.Client,"onDisconnect",function(){f.stopAllSounds()});EListener.on(VYLO.Client,"onNew",function(){p()});EListener.on(VYLO.Client,"onDel",function(){f.stopAllSounds()})}else console.error("Your device does not support window.AudioContext || window.webkitAudioContext. This library cannot be used")}})();